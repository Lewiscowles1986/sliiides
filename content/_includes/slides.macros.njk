{% import "utility.macros.njk" as utility %}

{% macro title(
  slide,
  class=none
) %}
  {% if slide.title %}
    <h2 {{ utility.attr_if('class', class) }}>
      {% if slide.pre -%}
        <span class="pre">{{ slide.pre | string | mdInline | safe }}</span>
      {%- endif %}
      {{ slide.title | mdInline | safe }}
    </h2>
    {% if slide.sub %}
      <p class="subtitle">{{ slide.sub | mdInline | safe }}</p>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro nav(
  index,
  count
) %}
  {% set count = count + 1 %}
  <nav class="slide-nav" aria-label="slide {{ index }}">
    {% if index > 0 %}
      <a href="#slide-{{ index - 1 }}">«<span class="sr-only">
        back to slide {{ index - 1 }}
      </span></a>
    {% endif %}
    <a href="#slide-{{ index }}" class="current"><span class="sr-only">
        this is slide
      </span>
      {{- index -}}/{{- count -}}
    </a>
    {% if index != count %}
      <a href="#slide-{{ index + 1 }}">»<span class="sr-only">
        on to slide {{ index + 1 }}
      </span></a>
    {% endif %}
  </nav>
{% endmacro %}

{% macro base(
  slide,
  name,
  page,
  styles=none,
  is='article',
  class=none
) %}
  {% set autoStyles = {
    '--resize': slide.resize
  } %}
  {% set styles = (autoStyles | merge(styles)) | merge(slide.styles) %}
  <{{ is or 'article'}}
    id="slide-{{ slide.index }}"
    data-slide="{{ slide.name or name }}"
    {{ utility.attr_if('class', class) }}
    {{ utility.style_if(styles or slide.styles) }}
    >

    <div
      class="slide-content"
      {{ utility.attr_if('data-resize', slide.resize) }}>
      {{ caller() }}
    </div>

    <footer class="slide-footer">
      <p class="slide-caption">
        {% if slide.caption %}
          {{ slide.caption | mdInline | safe }}
        {% endif %}
      </p>

      {{ nav(
        index=slide.index,
        count=page.data.slides | length
      ) }}
    </footer>
  </{{ is or 'article'}}>
{% endmacro %}
